<div *ngIf="page$ | async as page">

    <!-- Sidebar Widgets Column -->
    <aside [ngClass]="['col-sm-12 pt-2']">
        <div class="card mb-2">
            <div class="card-body pt-1 pb-0">
                <div class="row">
                    <a [routerLink]="['/note']" class="btn btn-primary" i18n>Create</a>
                </div>
            </div>
        </div>
        <div class="card mb-2">
            <div class="card-body pt-1 pb-0">
                <div class="row">
                    <div [ngClass]="tagCloudClass" (mouseover)="tagCloudClass='tag-cloud tag-cloud-hover'" (mouseout)="tagCloudClass='tag-cloud'">
                        <ul>
                            <li [ngClass]="[tag?.id == focusedTag?.id ? 'active' : '']" *ngFor="let tag of tagList; trackBy:pageService.trackByIndex">
                                <a (click)="loadByTag(tag)">
                                    <span>{{ tag.title }} ({{ tag.countOfUnreadText != undefined ? tag.countOfUnreadText: '?' }})</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </aside>

    <nav>
        <div class="nav nav-tabs" id="nav-tab" role="tablist">
            <a class="nav-item nav-link active" id="nav-notes-tab" data-toggle="tab" href="#nav-notes" role="tab" aria-controls="nav-notes" aria-selected="true" i18n>My Notes</a>
            <a class="nav-item nav-link" id="nav-archive-tab" data-toggle="tab" href="#nav-archive" role="tab" aria-controls="nav-archive" aria-selected="false" i18n>Archive</a>
            <a class="nav-item nav-link" id="nav-recycle-tab" data-toggle="tab" href="#nav-recycle" role="tab" aria-controls="nav-recycle" aria-selected="false" i18n>Recycle Bin</a>
        </div>
    </nav>
    <div class="tab-content" id="nav-tab-content">
        <div class="tab-pane fade show active border border-top-0 p-2 py-4" id="nav-notes" role="tabpanel" aria-labelledby="nav-notes-tab">
            <div class="card-deck card-deck-4 text-center" appScrollable (scrollPosition)="scrollHandler($event)">
                <div [ngClass]="['card mb-4 flex-row flex-wrap', noteItem.isArchived ? 'text-muted' : 'text-dark border-dark']" *ngFor="let noteItem of pagination.data | async; trackBy:pageService.trackByIndex"
                     (click)="showPreview(noteItem)">
                    <div class="row no-gutters">
                        <div class="col-auto">
                            <img class="img-fluid" *ngIf="noteItem.image" [src]="noteItem.image.url" alt="{{ noteItem.image.title }}"/>
                        </div>
                        <div class="col">
                            <div class="card-block px-2">
                                <h6 class="card-title">{{ noteItem.title }}</h6>
                                <div class="feed-item-html card-text small" *ngIf="noteItem.content" [innerHTML]="noteItem.content"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <p class="alert-warning" *ngIf="pagination.done | async" i18n>We ran out of items!</p>
            </div>
        </div>
        <div class="tab-pane fade" id="nav-archive" role="tabpanel" aria-labelledby="nav-archive-tab" i18n>...</div>
        <div class="tab-pane fade" id="nav-recycle" role="tabpanel" aria-labelledby="nav-recycle-tab" i18n>...</div>
    </div>


    <div class="row">
        <!-- Page Content -->
        <div class="col-sm-12 py-2" *ngIf="focusedItem">
            <div [ngClass]="['card', focusedItem.isArchived ? '' : 'border-dark']">
                <div class="card-header p-0">
                    <div class="float-left">

                    </div>

                    <div class="float-left ml-5 d-none d-sm-block">
                        <button class="btn ml-5 mt-1 px-3 py-0 btn-outline-secondary btn-sm" (mouseenter)="scrollContent(-2)" (mouseleave)="stopScrollContent()"
                                title="Scroll Up"><i class="fas fa-fw fa-arrow-up fa-lg"></i></button>
                        <button class="btn ml-0 mt-1 px-2 py-0 btn-outline-secondary btn-sm" (mouseenter)="scrollContent(2)" (mouseleave)="stopScrollContent()"
                                title="Scroll Down"><i class="fas fa-fw fa-arrow-down fa-lg"></i></button>
                        <button class="btn ml-0 mt-1 px-2 py-0 btn-outline-secondary btn-sm" (mouseenter)="scrollContent(4)" (mouseleave)="stopScrollContent()"
                                title="Scroll Down Faster"><i class="fas fa-fw fa-arrow-down fa-lg"></i></button>
                        <button class="btn ml-0 mt-1 px-2 py-0 btn-outline-secondary btn-sm" (mouseenter)="scrollContent(6)" (mouseleave)="stopScrollContent()"
                                title="Scroll Down More Faster"><i class="fas fa-fw fa-arrow-down fa-lg"></i></button>
                    </div>

                    <div class="float-right">
                        <button class="btn ml-3 mt-1 btn-sm" *ngIf="focusedItem.isArchived"
                                (click)="updateFeedItem(focusedItem, {isArchived: false})"
                                title="Mark As Unread"><i class="far fa-fw fa-registered fa-lg"></i></button>
                        <button class="btn ml-3 mt-1 btn-sm" *ngIf="!focusedItem.isArchived"
                                (click)="updateFeedItem(focusedItem, {isArchived: true})"
                                title="Mark As Read"><i class="fas fa-fw fa-registered fa-lg"></i></button>

                        <button class="btn ml-3 mt-1 btn-sm" *ngIf="focusedItem.isArchived"
                                (click)="updateFeedItem(focusedItem, {isArchived: false})"
                                title="Mark Me To Be Deleted"><i class="fas fa-fw fa-save fa-lg"></i></button>
                        <button class="btn ml-3 mt-1 btn-sm" *ngIf="!focusedItem.isArchived"
                                (click)="updateFeedItem(focusedItem, {isArchived: true})"
                                title="Keep Me Forever"><i class="far fa-fw fa-save fa-lg"></i></button>

                        <button class="btn ml-3 mt-1 btn-sm text-danger"
                                (click)="focusedItem = undefined"
                                title="Close"><i class="fa fa-fw fa-times fa-lg"></i></button>
                    </div>
                </div>
                <div id="focused-item-body" class="card-body content content-full">
                    <h2 class="card-title">{{ focusedItem.title }}</h2>
                    <div class="feed-item-html" [innerHTML]="focusedItem.content"></div>
                </div>
                <div class="card-footer py-0">
                    <div class="float-left">
                        {{ focusedItem.createdAt.seconds * 1000 | date: 'medium' }}
                    </div>
                    <div class="tag-cloud float-right mt-1 mb-0">
                        <ul>
                            <li *ngFor="let tag of focusedItem.tagList; trackBy:pageService.trackByIndex">
                                <a (click)="loadByTag(tag)">
                                    <span>{{ tag.title }}</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
